---
title: "Figures"
author: "Johannes Piipponen"
date: "2022-11-04"
output: html_document
---

! Tee kuvio 2 niin, että siinä on AGB + 3X proteiinikarttaa + 3X kcal karttaa ja ehkä FCR average? ---> muuta niin, että AGB ylhäällä 2 tiilen levyinen ja sitten rinnakkain protein_dairy ja energy_dairy tms
! Varmista että kuviot perustuvat lopulta simuloituun dataan!
! Muuta niin, että SI sisältää current irrigation applied


# Additional packages (in addition to those found in packages_etc_run_this_first.R)

```{r include = F}
packages <-  c("Rfast", "matrixStats")
lapply(packages, require, character.only = TRUE)
```


# Get and process simulated AGB data

# Process simulated AGB ---- now commented out to speed up
- Calculate median AGB over 2008-2012
- Calculate interannual variability IV
- Calculate uncertainty estimates CV


```{r}
# get simulated data
# r_agb_hydeareas_kg_km2 <-
#   here("Data", "Input", "from_harddrive",
#        "simulation_results_HYDEareas_nppv061_5arcmin_n1000.tif") %>% 
#   rast()
# 
# 
# sim_df <-   r_agb_hydeareas_kg_km2 %>% 
#   as.data.frame(., xy = T) %>% 
#   as_tibble()
# 
# 
#   ## calculate 5 years median for AGB
# agb_med_vars <- sim_df %>%  
#   dplyr::select(ab_med_2008,ab_med_2009,ab_med_2010, ab_med_2011,ab_med_2012) 
# 
# agb_5y_med_kg_km2 <- agb_med_vars %>% 
#   mutate(agb_med_median = rowMedians(as.matrix(agb_med_vars),na.rm = TRUE)) %>% 
#   bind_cols(sim_df %>% dplyr::select(x,y)) %>%  
#   dplyr::select(x,y, agb_med_median) %>% 
#   rast(., type = "xyz", crs = "EPSG:4326") %>% 
#   resample(., template_rast_5arcmin)
#   ## convert to kg per ha for figs
# agb_5y_med_kg_ha <- agb_5y_med_kg_km2 / 100
# 
# 
# 
# 
#   ## calculate Interannual variability for AGB
# ab_iv <- sim_df %>%
#   dplyr::select(contains("ab_med")) %>%
#   mutate(iv_ab = 100* as.matrix(.) %>% rowcvs()) %>%
#   bind_cols(sim_df %>% dplyr::select(x,y)) %>%  # get the coordinates
#   dplyr::select(x,y, iv_ab) %>%
#   rast(., type = "xyz", crs = "EPSG:4326") %>% 
#   resample(., template_rast_5arcmin)
# 
# 
# 
#   ## calculate CV for AGB
# ab_cv_vars <- sim_df %>%  
#   dplyr::select(ab_cv_2008,ab_cv_2009,ab_cv_2010, ab_cv_2011,ab_cv_2012) 
# 
# ab_cv <- ab_cv_vars %>% 
#   mutate(ab_cv_average = rowMedians(as.matrix(ab_cv_vars),na.rm = TRUE)) %>% 
#   bind_cols(sim_df %>% dplyr::select(x,y)) %>%  
#   dplyr::select(x,y, ab_cv_average) %>% 
#   rast(., type = "xyz", crs = "EPSG:4326") %>% 
#   resample(., template_rast_5arcmin)
# 
# 
# # -------------------------- combine files that are derived from simulated agb
# r_simulated_agb_vars <- c(
#   agb_5y_med_kg_km2,
#   ab_iv,
#   ab_cv)
# 
# writeRaster(r_simulated_agb_vars, filename = 
#               here("Data", "Intermediate_input", "simulated_agb5v_agbIV_agbCV.tif"))


################################## get the file
r_simulated_agb_vars <- 
  here("Data", "Intermediate_input", "simulated_agb5v_agbIV_agbCV.tif") %>% 
  rast()
plot(r_simulated_agb_vars)
```

# Color palettes for plotting

```{r}
pal_npp <- scico(n = 5,begin = 0.6, end = 1, palette = "corkO")
# scico(n = 6, palette = "bamako", direction = -1, begin = 0.5, end = 1)
pal_agb <- scico(n = 6, palette = "bamako", direction = -1)
# pal_protein <- scico(n = 10, palette = "hawaii", begin = 0.05,end = 0.85,
#                               direction = -1) # use lajolla instead!
pal_protein_lajolla <- scico(n = 6, palette = "lajolla", end = 0.85) 

pal_fcr <- scico(n = 6, palette = "tokyo", direction = -1)
pal_cv <-  scico(n = 6, palette = "nuuk", direction = -1)
```




# Plot AGB in HYDE areas (kg per ha) 
! Country borders or just use regions instead? --> maybe ok in supplementary like this

```{r}
  ## AGB
(plt_agb_hyde_over2008_2012_kg_ha <- 
    create_index_map(r_index = r_simulated_agb_vars$agb_med_median / 100, # div by 100 to get unit as kg/ha 
                     tocrs = "ESRI:54030",
                     index_main_title = "Median aboveground biomass (AGB) in Hyde areas over 2008-2012",
                     index_label = "AGB kg/ha",
                     colorpal = pal_agb, 
                     breakvals =  c(-Inf,500,1000,2000,3000,4000, Inf), 
                     breaknames = c( "< 500", "500-1000","1000-2000",
                                     "2000-3000", "3000-4000", "> 4000")) ) 


  ## Interannual variability
(plt_agb_iv <- 
  create_index_map(r_index = r_simulated_agb_vars$iv_ab ,
                   tocrs = "ESRI:54030",
                   index_main_title = "Interannual variability in AGB over 2001-2020 [%]",
                   index_label = "IV in %",
                   colorpal = pal_cv,
                   breakvals = c(0,10,20,30,40,50,Inf),
                   breaknames = c("< 10",
                                  "10-20",
                                  "20-30",
                                  "30-40",
                                  "40-50",
                                  "> 50"))) 


(plt_agb_cv<-
  create_index_map(r_index = r_simulated_agb_vars$ab_cv_average *100,
                   tocrs = "ESRI:54030",
                   index_main_title = "Uncertainty related to aboveground biomass (AGB) measured with coefficient of variation (CV)",
                   index_label = "CV in %",
                   colorpal = pal_cv,
                   breakvals = c(0,10,20,30,40,50,Inf),
                   breaknames = c("< 10",
                                  "10-20",
                                  "20-30",
                                  "30-40",
                                  "40-50",
                                  "> 50"))) 




plts_abg_iv_cv <- tmap_arrange(
  plt_agb_hyde_over2008_2012_kg_ha,
  plt_agb_iv,
  plt_agb_cv,
  ncol = 2
)
plts_abg_iv_cv
## save these together with average FCR map ---> saved in next chunk

tmap_save(plts_abg_iv_cv, 
          here("Figures", "AGB_IV_CV_in_HYDEareas.pdf"),
          width = 180, height = 150, units = "mm")
```









# Plot Figure 2
- FCR, protein, kcal from AGB

Feed Converstion Ratios (FCR) for different animal species.

How much protein and kcal livestock can produce from AGB?
- Beef cattle 
- Dairy cattle
- Sheep and goats


```{r}

# FCR
(plt_fcrs <- 
    create_index_map(r_index =  r_fcr,
                     tocrs = "ESRI:54030",
                     index_main_title = "Feed conversion ratios (FCR) by animal species",
                     index_label = "[kg AGB / kg protein]",
                     colorpal = pal_fcr,
                     breakvals = c(-Inf,100,200, 300,400,500,Inf),
                     breaknames = c("<100","100-200","200-300","300-400","400-500", ">500"))) 








# Protein
quantile(values(r_protein_from_065xAGB_kg_ha$dairy), probs = c(seq(0,1, by = 0.1666667)), na.rm =T)

(plt_animalprotein_hydeareas <- 
    create_index_map(r_index = r_protein_from_065xAGB_kg_ha, # kg per ha
                     tocrs = "ESRI:54030",
                     index_main_title = "Animal protein production from aboveground biomass (AGB)",
                     index_label = "[kg/ha]",
                     colorpal = pal_protein_lajolla,
                     breakvals = c(0, 1, 5, 10, 25, 50, Inf),
                     breaknames = c("<1","1-5", "5-10",
                                  "10-25","25-50",  ">50"))) 


# (plt_animalprotein_nomask_average <- 
#     create_index_map(r_index = r_animalprot_fromAGB_kg_ha$On_average, # kg per ha
#                      tocrs = "ESRI:54030",
#                      index_main_title = "Average animal protein production from aboveground biomass (AGB)",
#                      index_label = "[kg/ha]",
#                      colorpal = pal_protein,
#                      breakvals = c(0,1,5,10, 50,100, Inf),
#                      breaknames = c("0-1","1-5", "5-10",
#                                   "10-50","50-100",  ">100"))) 
# 

# tmap_save(plt_animalprotein_nomask,
#           here("Figures", "Protein_from_AGB_in_HYDEareas_by_species.pdf"),
#           width = 180, height = 150, units = "mm")




# ------------------------------------------------------------------- energy
quantile(values(r_kcal_from_065xAGB_MM_ha$dairy_MMkcal_ha), probs = c(seq(0,1, by = 0.1666667)), na.rm =T)

(plt_animal_kcal_hydeareas <- 
    create_index_map(r_index = r_kcal_from_065xAGB_MM_ha, 
                     tocrs = "ESRI:54030",
                     index_main_title = "Livestcok energy production from aboveground biomass (AGB)",
                     index_label = "[million kcal/ha]",
                     colorpal = pal_protein_lajolla,
                     breakvals = c(0, 0.02, 0.05, 0.1, 1, 5, Inf),
                     breaknames = c("<0.02","0.02-0.05",
                                  "0.05-0.1","0.1-1", "1-5", ">5"))) 






plts_fig2_FCR_protein_kcal <- tmap_arrange(
  plt_fcrs,
  plt_animalprotein_hydeareas,
  plt_animal_kcal_hydeareas,
  ncol = 3
)

plts_fig2_FCR_protein_kcal # modify more in illustrator

tmap_save(plts_fig2_FCR_protein_kcal, filename = 
            here("Figures", "fig2 livestock FCR prot kcal.pdf"))




```







# Crops - production, protein and energy and suitabilities

```{r}

# Total production of 27 crops
(plt_total_production_crops <-
    create_index_map(r_index = r_global_production_crops_sum_kg_ha, 
                   tocrs = "ESRI:54030",
                   index_main_title = "Combined crop yields of SPAM food crops in 2010",
                   index_label = "[kg/ha]",
                   colorpal = pal_agb,
                   breakvals = c(0,2000,4000,6000, 8000, Inf),
                   breaknames = c("0-2000","2000-4000",
                                  "4000-6000","6000-8000",  ">8000"))) 
#summary(r_global_prod_crops_sum_mt) # median 1400 mean 5700 3rd = 5900



# Protein, sum of 27 crops
quantile(values(r_prot_allcrops_sum_kg_ha), probs = c(seq(0,1, by = 0.1666667)), na.rm =T)

(plt_crop_protein <- 
  create_index_map(r_index = r_prot_allcrops_sum_kg_ha, 
                   tocrs = "ESRI:54030",
                   index_main_title = "Protein production of SPAM food crops in 2010",
                   index_label = "[kg/ha]",
                   colorpal = pal_protein_lajolla,
                   breakvals = c(0, 10, 50, 100, 250, 500, Inf),
                   breaknames = c("0-10","10-50", "50-100",
                                  "100-250","250-500",  ">500"))) 




# Energy, sum of 27 crops
quantile(values(r_kcal_allcrops_sum_MM_ha), probs = c(seq(0,1, by = 0.1666667)), na.rm =T)


(plt_crop_kcal <- 
    create_index_map(r_index = r_kcal_allcrops_sum_MM_ha, # millions of kcal
                     tocrs = "ESRI:54030",
                     index_main_title = "Energy production of crops in 2010",
                     index_label = "[million kcal/ha]",
                     colorpal = pal_protein_lajolla,
                     breakvals = c(0, 0.2, 0.5, 1, 10, 50, Inf),
                     breaknames = c("<0.2","0.2-0.5",
                                  "0.5-1","1-10", "10-50", ">50"))) 






# SI, crops --- more about SI classes: https://www.nature.com/articles/s41597-022-01632-8
SI_5arcmin <- here("Data", "Input", "from_harddrive", "SI_v3.0_5arcmin.tif") %>% 
  rast() # Change this in harddrive -- 0 value should be excluded first

SI_5arcmin_0_toNA <- classify(SI_5arcmin, cbind(0, NA)) # because we dont want to plot no-suitable land

# pal_SI <- scico(n =3, palette = "bam", begin = 0.6)
# pal_SI <- scico(n =11, palette = "bam")
# pal_SI <- pal_SI[c(3,7,11)] # this to get light red, light and dark green values

(plt_SI_v3.0 <- create_index_map(r_index = SI_5arcmin_0_toNA, tocrs = "ESRI:54030",
                     index_main_title = "Overall suitability indices (SI) for crops over 1980-2009",
                     index_label = "",
                     colorpal = pal_agb,
                     breakvals =  c(1, 33, 75, Inf),
                     breaknames = c("Marginally suitable (1 < SI < 33 )", 
                                    "Moderately suitable (33 <= SI <= 75 )", "Highly suitable (SI > 75)")) )





# ------------------------------------------------------------- arrange and save
plts_crops <- tmap_arrange(
  plt_total_production_crops, #  is this relevant?
  plt_crop_protein,
  plt_crop_kcal,
  plt_SI_v3.0
)

plts_crops
tmap_save(plts_crops, here("Figures", "27 crops protein energy and SI.pdf"))






```


# Plot comparison part 1
-shares of total protein

```{r}
quantile(values(r_share_of_total_protein_livestock), probs = c(seq(0,1, by = 0.1666667)), na.rm =T)
# share of protein originatin from crops
# pal_share2 <-  scico(n = 7, palette = "davos", begin = 0.2, end = 0.9, direction = -1) 
# pal_share1 <-  scico(n = 10, palette = "bam", begin = 0.1, end = 0.9, direction = -1) 
pal_share <-  scico(n = 10, palette = "roma", begin = 0.1, end = 0.9, direction = -1) # change name?






  ## share of livestock of total protein
(plt_shareoflivestock_of_total_protein <- 
    create_index_map(r_index = r_share_of_total_protein_livestock, # toimiii, pitää toki vielä hioa
                     tocrs = "ESRI:54030",
                     index_main_title = "Grazing livestock's share of combined protein production on agricultural land",
                     index_label = "<---crops produce more           livestock produce more --->",
                     colorpal = pal_share,
                     breakvals = c(0, 10, 25, 50, 75, 90, 100),
                     breaknames = c("<10", "10-25", "25-50","50-75","75-90", "90-100"))) 





  ## share of livestock of total protein on cropland areas
(plt_shareoflivestock_of_total_protein_croplandmask <- 
    create_index_map(r_index = r_share_of_total_protein_livestock_croplandmask, 
                     tocrs = "ESRI:54030",
                     index_main_title = "Grazing livestock's share of combined protein production on croplands",
                     index_label = "<---crops produce more           livestock produce more --->",
                     colorpal = pal_share,
                     breakvals = c(0, 10, 25, 50, 75, 90, 100),
                     breaknames = c("<10", "10-25", "25-50","50-75","75-90", "90-100"))) 



  ## share of livestock of total protein on croplands where SI below 10 -- first masked SIbelow 10 to croplands and then livestock raster is masked with that one
(plt_shareoflivestock_of_total_protein_SIbelow10_croplandmask <- 
    create_index_map(r_index = r_share_of_total_protein_livestock_SIbelow10mask_croplandmask, 
                     tocrs = "ESRI:54030",
                     index_main_title = "Grazing livestock's share of combined protein production on croplands with low suitability (SI < 10)",
                     index_label = "<---crops produce more           livestock produce more --->",
                     colorpal = pal_share,
                     breakvals = c(0, 10, 25, 50, 75, 90, 100),
                     breaknames = c("<10", "10-25", "25-50","50-75","75-90", "90-100"))) 




plts_shareofprotein <-
tmap_arrange(
  plt_shareoflivestock_of_total_protein,
  plt_shareoflivestock_of_total_protein_croplandmask,
  plt_shareoflivestock_of_total_protein_SIbelow10_croplandmask,
  ncol = 3
)
plts_shareofprotein

tmap_save(plts_shareofprotein, filename = here("Figures", "plts_shareofprotein.pdf"))
```







# Plot comparisons part 2 - potentials
From suitabilities script

```{r}

(plt_r_share_SIover75max <- 
    create_index_map(r_index = r_fraction_SIover75_max_0toNA*100, # updated so 0 areas are white
                     tocrs = "ESRI:54030",
                     index_main_title = "Share of very suitable land area that could be used for crop production",
                     index_label = "% of cell",
                     colorpal = pal_share_nuuk,
                     breakvals = c(0, 10, 20, 40, 60, 80, 100),
                     breaknames = c("<10", "10-20", "20-40", "40-60","60-80", "80-100")))



(plt_percent_gl_should_decline <- 
    create_index_map(r_index = r_how_many_percent_gl_should_decline_0toNA, 
                     tocrs = "ESRI:54030",
                     index_main_title = "How much grazing lands area could decline (to make space for crops)",
                     index_label = "%",
                     colorpal = pal_share_nuuk,
                     breakvals = c(0, 10, 20, 60, 80, 100, Inf),
                     breaknames = c("<10", "10-20", "20-60", "60-80", "80-100", ">100")))


(plt_percent_cl_should_increase <- 
    create_index_map(r_index = r_how_many_percent_cl_should_increase, 
                     tocrs = "ESRI:54030",
                     index_main_title = "How much cropland area could increase (at the cost of grazing lands)",
                     index_label = "",
                     colorpal = pal_share_nuuk,
                     breakvals = c(0, 10, 20, 60, 80, 100, Inf),
                     breaknames = c("<10", "10-20", "20-60", "60-80", "80-100", ">100")))



(plt_r_optimized_protein_yield_larger <-
      create_index_map(r_index = r_optimized_protein_yield_larger$dairy, 
                     tocrs = "ESRI:54030",
                     index_main_title = "Optimised protein production compared to original combined protein production \n (here dairy + crops considered)",
                     index_label = "%",
                     colorpal = pal_share_nuuk,
                     breakvals = c(-Inf, 1, 20, 50, 100, Inf),
                     breaknames = c("No change", "<20", "20-50", "50-100", ">100")))


plts_optimised <- tmap_arrange(
  plt_r_share_SIover75max,
  plt_percent_gl_should_decline,
  plt_percent_cl_should_increase,
  plt_r_optimized_protein_yield_larger
)

tmap_save(plts_optimised, here("Figures", "plts_optimised.pdf"))
```


























# 33333333333333333333333333333333333333333333333333333333333333 old after this

# Plot comparisons part 1: animal protein vs crop protein 
- Crop protein production in areas where MapSPAM area overlay with pasturelands ----- no overlay needed
- Animal protein in MapSPAM production areas
- Extra protein animals could produce in MapSPAM production areas
- Animal protein outside MapSPAM production areas



```{r}


# tmap_save(plt_crop_protein,
#           here("Figures", "Crop protein production in 2010.pdf"),
#           width = 180, height = 150, units = "mm")

  ## Animal protein in MapSPAM prod areas ----> ei kosktettu per ha muunnoksen jälkeen
# (plt_animalprotein_mapspam_areas <- 
#     create_index_map(r_index = r_animalprot_fromAGB_mt_mapspam_areas$On_average,
#                      tocrs = "ESRI:54030",
#                      index_main_title = "Average animal protein production from AGB (nosim median AGB)\non crop production areas (mt)",
#                      index_label = "[metric tons]",
#                      colorpal = pal_protein,
#                      breakvals = c(0,10,20,40,100, 200, Inf),
#                      breaknames = c("0-10", "10-20","20-40",
#                                     "40-100","100-200", ">200"))) 



  ## Extra animal protein ----> ei kosktettu per ha muunnoksen jälkeen
# (plt_extra_animal_protein_in_crop_prod_areas <- 
#     create_index_map(r_index = r_extra_protein_mt_mapspam_areas_average,
#                      tocrs = "ESRI:54030",
#                      index_main_title = "Extra animal protein production potential\n on crop production areas (mt) (extra = fraction of pixel unutilized by crops)",
#                      index_label = "[metric tons]",
#                      colorpal = pal_protein,
#                      breakvals = c(0,10,20,40,100, 200, Inf),
#                      breaknames = c("0-10", "10-20","20-40",
#                                     "40-100","100-200", ">200"))  )




  ## Hyde Animal protein outside MapSPAM crop production areas
(plt_animal_protein_outside_crop_prod_areas <- 
    create_index_map(r_index = r_animalprot_fromAGB_outside_MapSPAM_kg_ha,
                     tocrs = "ESRI:54030",
                     index_main_title = "Animal protein production potential outside\n crop production areas (mt)",
                     index_label = "[metric tons]",
                     colorpal = pal_protein,
                     breakvals = c(0,10,20,40,100, 200, Inf),
                     breaknames = c("0-10", "10-20","20-40",
                                    "40-100","100-200", ">200"))) 


(plt_animal_protein_outside_crop_prod_areas_average <- 
    create_index_map(r_index = r_animalprot_fromAGB_outside_MapSPAM_kg_ha$On_average,
                     tocrs = "ESRI:54030",
                     index_main_title = "Average animal protein production outside\n crop production areas (mt)",
                     index_label = "[metric tons]",
                     colorpal = pal_protein,
                     breakvals = c(0,10,20,40,100, 200, Inf),
                     breaknames = c("0-10", "10-20","20-40",
                                    "40-100","100-200", ">200"))) 


tmap_save(plt_animal_protein_outside_crop_prod_areas_average,
          here("Figures", "Animal protein outside HYDE areas.pdf"),
          width = 180, height = 150, units = "mm")


plts_protein_production_animals_crops <-
  tmap_arrange(plt_crop_protein,
               plt_animalprotein_mapspam_areas,
               plt_extra_animal_protein_in_crop_prod_areas,
               plt_animal_protein_outside_crop_prod_areas,
               ncol = 2               )


# tmap_save(plts_protein_production_animals_crops,
#           here("Figures", "Protein production animals and crops.pdf"),
#           width = 180, height = 150, units = "mm")


hist(r_prot_allcrops_sum_kg_ha, xlim = c(0,250), breaks = 100)

```






# Plot comparisons part 2
- Crop production areas where animals can produce more protein than crops
- Animals protein production capacity on areas where crop SI < 10 or crop prod areas where SI > 75?

 ? what about map showing animal protein production on area where cropland is going to expand 


```{r}
# where protein animals  > protein  crops (in crop prod areas)
r_crop_prot_animal_prot_ratio <- 
  r_prot_allcrops_sum_mt_pasturemask /
  r_animalprot_fromAGB_mt_mapspam_areas_average# div 0 problems?


  ## try to map "crops prod less", "crops produce 1-10x more", "crops produce 10-100x more"
# find colors
pal_light <- scico(n = 10, palette = "bam", end = 0.7)
pal_light <- c(pal_light %>% first(1), 
               pal_light %>% last(3))

  ## map that shows where animal outperforms the crops but also where crops produce 100x more
(plt_animals_crops_ratio <- 
    create_index_map_no_cntry(r_index = r_crop_prot_animal_prot_ratio,
                     tocrs = "ESRI:54030",
                     index_main_title = "Protein production capacity on croplands, crops vs livestock",
                     index_label = "Protein production",
                     colorpal = pal_light, # first color is green
                     breakvals = c(0, 1, 10, 100, Inf),
                     breaknames = 
                       c("crops produce less",
                         "crops produce 1-10x more",
                         "crops produce 10-100x more",
                         "crops produce >100x more"  )  ) )








## data from Florian Zabel 2022, modified in suitabilities.R
## animal protein production on cropland areas where cropland suitability is below 10
  ## check if this suitability data is the same   
  ## https://www.nature.com/articles/s41597-022-01632-8#Fun 


#   ## SI < 10


# (plt_animalprot_in_croplands_where_SI_below10<-
#     create_index_map_no_cntry(r_index = r_animal_protein_mt_in_croplands_SI_below10,
#                      tocrs = "ESRI:54030",
#                      index_main_title = "Animal protein production on crop production areas where crop suitability < 10",
#                      index_label = "[metric tons]",
#                      colorpal = pal_protein,
#                      breakvals = c(0,10,20,40,100, 200, Inf),
#                      breaknames = c("0-10", "10-20","20-40",
#                                     "40-100","100-200", ">200"))  )

  ## SI < 25
# (plt_animalprot_in_croplands_where_SI_below25<- 
#     create_index_map_no_cntry(r_index = r_animal_protein_mt_in_croplands_SI_below25,
#                      tocrs = "ESRI:54030",
#                      index_main_title = "Animal protein production on crop production areas where crop suitability < 25",
#                      index_label = "[metric tons]",
#                      colorpal = pal_protein,
#                      breakvals = c(0,10,20,40,100, 200, Inf),
#                      breaknames = c("0-10", "10-20","20-40",
#                                     "40-100","100-200", ">200"))  )


# 
# plts_animals_outperform_and_lowSI_croplands <-
#   tmap_arrange(
#     plt_animals_crops_ratio,
#     plt_animalprot_in_croplands_where_SI_below10,
#     plt_animalprot_in_croplands_where_SI_below25,
#     ncol = 2  )
# 
# 
# tmap_save(plts_animals_outperform_and_lowSI_croplands,
#           here("Figures", "Animals outperform crops and low SI areas.pdf"),
#           width = 180, height = 150, units = "mm")

```



# Plot interannual variability and uncertainty (CV)

```{r}
(plt_agb_iv <- 
  create_index_map(r_index = ab_iv ,
                   tocrs = "ESRI:54030",
                   index_main_title = "Interannual variability in AGB over 2001-2020 [%]",
                   index_label = "IV in %",
                   colorpal = pal_cv,
                   breakvals = c(0,10,20,30,40,50,Inf),
                   breaknames = c("< 10",
                                  "10-20",
                                  "20-30",
                                  "30-40",
                                  "40-50",
                                  "> 50"))) 


(plt_agb_cv<-
  create_index_map(r_index = ab_cv *100,
                   tocrs = "ESRI:54030",
                   index_main_title = "Uncertainty related to aboveground biomass (AGB) measured with coefficient of variation (CV)",
                   index_label = "CV in %",
                   colorpal = pal_cv,
                   breakvals = c(0,10,20,30,40,50,Inf),
                   breaknames = c("< 10",
                                  "10-20",
                                  "20-30",
                                  "30-40",
                                  "40-50",
                                  "> 50"))) 



# fig2 <- tmap_arrange(
#   plt_agb_5y,
#   plt_agb_iv,
#   plt_agb_cv,
#   plt_fcr_on_average,
#   ncol = 2)
# 
# fig2
# 
# tmap_save(fig2, 
#           here("Figures", "AGB AGB_IV AGB CV FCR_average.pdf"),
#           width = 180, height = 150, units = "mm")
```


# Plot shares of pixel covered by croplands (cl) and grazing lands (gl) and sum of those

! add also fraction where land is very suitable? Or where it is not suitable at all? Or this to somewhere else?

```{r}
# gather data
r_fractions_gl_cl_total <- 
  c(r_grazingland_fraction, r_fraction_of_crops_in_cell, fraction_total)
names(r_fractions_gl_cl_total) <- c("fraction_gl", "fraction_cp", "fraction_total")
plot(r_fractions_gl_cl_total)
pal_fraction<-  scico(n = 10, palette = "hawaii", begin = 0.1, end = 0.8)

(plt_fractions <- 
      create_index_map(r_index = 100*r_fractions_gl_cl_total,
                     tocrs = "ESRI:54030",
                     index_main_title = "Share of land area used for different agricultural practises",
                     index_label = "%",
                     colorpal = pal_fraction,
                     breakvals = seq(0, 100, 10),
                     breaknames = c("0-10", "10-20", "20-30", "30-40", "40-50",
                                    "50-60", "60-70", "70-80", "80-90", "90-100"))) 
# sequence <- seq(0, 100, 10)
# class_labels <- paste0(sequence, "-", sequence + 10)
# class_labels <- class_labels[-length(class_labels)]


```




# test

```{r}


```

