---
title: "Explore predicted yields"
output: html_document
date: "2023-08-02"
---

Testataan tulee predicted yielseistä samanlaiset kuin suitability scriptissä tapauksessa jossa kaikki maa allokoitu cl tai gl

--> AGB proteiinin kohdalla ei ihan yhteneväiset tulokset predicted ja SI>99 välillä. Maissivyöllä ei ole AGB proteiinia koska oletamme, ettei siellä oleva cl häviä minnekään. AGB proteiinia siis vain alueilla joilla on gl --> voisi olla samanlaiset kuvat jos otettaisiin tulokset suitabilityskriptistä, jossa cl voi vähentyä

--> Masan skenaarioissa voisi käyttää predicted protein niin saataisiin katsottua paremmin paljonko LUR voisi olla kun kaikki maa-ala gl tai kaikki cl

# First existing yield

```{r}
(plt_animalprotein_hydeareas_current <- 
    create_index_map(r_index = r_protein_from_AGB_kg_ha$current_herd_str, 
                     tocrs = "ESRI:54030",
                     index_main_title = "Animal protein production from aboveground biomass (AGB)",
                     index_label = "[kg/ha]",
                     colorpal = pal_protein_lajolla,
                     breakvals = c(0, 1, 5, 10, 25, 50, Inf),
                     breaknames = c("<1","1-5", "5-10",
                                  "10-25","25-50",  ">50"))) 

```

# 

```{r}
r_optimised_combined_protein_yield_kg_perpix_clCANdec <-
  here("Data", "Intermediate_input2", "r_optimised_combined_protein_yield_kg_perpix.tif") %>% 
  rast() # cl CAN decreaseq!!


# muutetaan per pix to kg ha --- ei pidä olla positive
prot_fromAGB_whenAllSuitableLand_gl <- r_optimised_combined_protein_yield_kg_perpix_clCANdec$prot_kgpix_SI99 
# kun kaikki SI>0 maat cl, gl proteiinia nolla (cl proteiinia paljon, mutta ei näy tässä)
# kun kaikki aluuet gl, niin proteiinia paljon. Eli jos SI >= 99 niin vain grazing landia


prot_fromAGB_whenAllSuitableLand_gl <- # per ha
  prot_fromAGB_whenAllSuitableLand_gl / 
  (cellSize(prot_fromAGB_whenAllSuitableLand_gl, unit = "ha") * r_fraction_gl_cl_total_0toNA)



(plt_animalprotein_whenallsuitableland_gl<- 
    create_index_map(r_index = prot_fromAGB_whenAllSuitableLand_gl, 
                     tocrs = "ESRI:54030",
                     index_main_title = "AGB prot when all unsuitable land gl",
                     index_label = "[kg/ha]",
                     colorpal = pal_protein_lajolla,
                     breakvals = c(0, 1, 5, 10, 25, 50, Inf),
                     breaknames = c("<1","1-5", "5-10",
                                  "10-25","25-50",  ">50"))) 




# huomaa että ei pidä olla eka layeri joka olettaa että myös täysin sopimattomat SI = 0 maat sopivat kasveille
prot_crops_whenAllSuitableLand_cl <- r_optimised_protein_crops_mt_perpix_positive$cropProt_mtpix_SI1 * 1000

prot_crops_whenAllSuitableLand_cl <- prot_crops_whenAllSuitableLand_cl / 
  (cellSize(prot_crops_whenAllSuitableLand_cl, unit = "ha") * r_fraction_gl_cl_total_0toNA)


(plt_crop_protein_whenallsuitableland_cl <- 
  create_index_map(r_index = prot_crops_whenAllSuitableLand_cl, 
                   tocrs = "ESRI:54030",
                   index_main_title = "Prot prod crops when all suitable land is cl",
                   index_label = "[kg/ha]",
                   colorpal = pal_protein_lajolla,
                   breakvals = c(0, 10, 50, 100, 250, 500, Inf),
                   breaknames = c("0-10","10-50", "50-100",
                                  "100-250","250-500",  ">500"))) 

# ! Kun myös SI = 0 maat mukana niin samanlainen kuin predicted crop protein + existing crop protein

```



# Nyt verrataan näitä ihan vain lm saatuihin satoihin

Tietenkin erilaiset sadot, koska näissä näkyy vain ennustetut sadot, ei todellisia niiltäkään alueilta joilla on gl tai cl

```{r}
# pure prediction
(plt_animal_protein_predicted <- 
  create_index_map(r_index =
                     mask(r_predicted_AGB_based_protein_yield_kg_ha,
                          r_fraction_gl_cl_total_0toNA),
                   tocrs = "ESRI:54030",
                   index_main_title = "PREDICTED AGB prot ", 
                   index_label = "",
                   colorpal = pal_protein_lajolla,
                   breakvals = c(0, 1, 5, 10, 25, 50, Inf), # 1/10 of crops
                   breaknames = c(""))) 



(plt_crop_protein_predicted <- 
  create_index_map(r_index = r_predicted_crop_protein_yield_kg_ha,
                   tocrs = "ESRI:54030",
                   index_main_title = "PREDICTED crop prot ",
                   index_label = "",
                   colorpal = pal_protein_lajolla,
                   breakvals = c(0, 10, 50, 100, 250, 500, Inf),
                   breaknames = c("")))   

# Same but existing areas + new areas


# # predicted yields outside their present production areas
# (plt_AGB_protein_predicted_masked_outside_gl <-
#   create_index_map(r_index =
#    r_predicted_AGB_based_protein_yield_on_cl_where_agb_prot_yield_not_known_kg_ha,
#                    tocrs = "ESRI:54030",
#                    index_main_title = "PREDICTED AGB prot yield on croplands where AGB prot yield not known", # outside current croplands
#                    index_label = "[kg/ha]",
#                    colorpal = pal_protein_lajolla,
#                    breakvals = c(0, 1, 5, 10, 25, 50, Inf), # 1/10 of crops
#                    breaknames = c("0-1","1-5", "5-10",
#                                   "10-25","25-50",  ">50")))
# 
# 
# (plt_crop_protein_predicted_outside_cl_but_in_gl <- 
#   create_index_map(r_index = r_predicted_protein_yield_outside_cl_but_in_gl_areas_kg_ha,
#                    tocrs = "ESRI:54030",
#                    index_main_title = "PREDICTED crop protein yields outside current croplands -- cannot be this high e.g. Tibet where SI = 0", #  
#                    index_label = "[kg/ha]",
#                    colorpal = pal_protein_lajolla,
#                    breakvals = c(0, 10, 50, 100, 250, 500, Inf),
#                    breaknames = c("0-10","10-50", "50-100",
#                                   "100-250","250-500",  ">500"))) 
# 



```

# Save maps
Tallenna suitabilities scriptin avulla saatu proteiinisato ja vertaa sitä regression avulla saatuun proteiinisatoon

```{r}
plts_compare_protein <- tmap_arrange(
  plt_animalprotein_whenallsuitableland_gl,
  plt_crop_protein_whenallsuitableland_cl,
  plt_animal_protein_predicted,
  plt_crop_protein_predicted
)

tmap_save(plts_compare_protein,
          filename = here("Delete", "compare_yields.png"))

```

