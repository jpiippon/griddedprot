1.5*30
0.9/0.3
r_optimized_protein_crops_test_on_croplands_75 <-
((r_fraction_cl_0toNA + r_potential_cropland_expansion_croplandmask_fraction[[75]]) /
r_fraction_cl_0toNA) *
r_prot_allcrops_sum_mt_perpix
global(r_optimized_protein_crops_test_on_croplands_75, "sum", na.rm=T)/1e6 # 261 mmt
975-450
plot(r_potential_cropland_expansion_croplandmask_fraction[[75]])
r_prot_allcrops_sum_kg_ha %>% plot()
r_prot_allcrops_sum_kg_ha
r_extra_protein_crops_test2_croplands_75 <-
r_prot_allcrops_sum_kg_ha * # HA
cellSize(r_prot_allcrops_sum_kg_ha, unit = "ha")*
r_potential_cropland_expansion_croplandmask_fraction[[75]]
global(r_extra_protein_crops_test2_croplands_75, "sum", na.rm=T)/1e6 #
r_prot_allcrops_sum_kg_ha
r_extra_protein_crops_test2_croplands_75 <-
f_raster_without_outliers(r_prot_allcrops_sum_kg_ha) * # HA
cellSize(r_prot_allcrops_sum_kg_ha, unit = "ha")*
r_potential_cropland_expansion_croplandmask_fraction[[75]]
global(r_extra_protein_crops_test2_croplands_75, "sum", na.rm=T)/1e6 #
f_raster_without_outliers(r_prot_allcrops_sum_kg_ha)
r_potential_cropland_expansion_croplandmask_fraction[[75]]
summary(r_potential_cropland_expansion_croplandmask_fraction[[75]] )
r_extra_protein_crops_test2_croplands_75 <-
r_prot_allcrops_sum_kg_ha *
#f_raster_without_outliers(r_prot_allcrops_sum_kg_ha) * # 21 - 4235 kg per ha
cellSize(r_prot_allcrops_sum_kg_ha, unit = "ha")*
r_potential_cropland_expansion_croplandmask_fraction[[75]] # -1 to 1
f_global_sum_without_outliers(r_extra_protein_crops_test2_croplands_75)/1e6
f_global_sum_without_outliers(r_extra_protein_crops_test2_croplands_75)/1e9
df_SI <-
tibble(
SI_class = threshold_values,
Current_grazingland_area_total_Mha =
pull(global((r_fraction_gl * cellSize(r_fraction_gl, unit = "ha")), "sum", na.rm = T)/1e6),
Current_cropland_area_total_Mha =
pull(global((r_fraction_cl * cellSize(r_fraction_cl, unit = "ha")), "sum", na.rm = T)/1e6),
Current_agricultural_total_area_Mha =
pull(global((r_fraction_gl_cl_total * cellSize(r_fraction_gl_cl_total, unit = "ha")), "sum",
na.rm = T)/1e6),
SI_based_unrestricted_cropland_Mha =
pull(global(r_SIbased_unrestricted_cropland_ha_perpix, "sum", na.rm=T)/1e6),
SI_based_restricted_max_cropland_Mha =
pull(global(r_SIbased_restricted_max_cropland_ha_perpix, fun = "sum", na.rm = T)/1e6))
df_SI <- df_SI %>%
mutate(potential_cropland_expansion_Mha =
pull(global(r_potential_cropland_expansion_ha_perpix,
fun = "sum", na.rm = T)/1e6),
potential_cropland_expansion_outside_cl_Mha =
pull(global(r_potential_cropland_expansion_outside_croplands_ha_perpix ,
fun = "sum", na.rm = T)/1e6 ),
potential_cropland_expansion_cl_mask_Mha =
pull(global(r_potential_cropland_expansion_croplandmask_ha_perpix ,
fun = "sum", na.rm = T)/1e6))
df_SI
View(df_SI)
975 - 450
(975 - 450)/975
450/975
(975 - 450)/450
174/274
274-126
174/274
148/274
# Suodata sarakkeet, joiden nimessä on "Mha"
Mha_columns <- grep("Mha", colnames(df_SI), value = TRUE)
prot_columns <- grep("protein", colnames(df_SI), value = TRUE)
# Muuta df_SI:n pitkäksi muodoksi
df_SI_long_Mha <- df_SI %>%
dplyr::select(SI_class, all_of(Mha_columns)) %>%
dplyr::select(-c(potential_grazingland_reduction_Mha,
potential_grazingland_reduction_cl_mask_Mha,
potential_grazingland_reduction_outside_cl_Mha   )) %>%
pivot_longer(cols = -SI_class, names_to = "Variable", values_to = "Value")
Mha_columns <- grep("Mha", colnames(df_SI), value = TRUE)
prot_columns <- grep("protein", colnames(df_SI), value = TRUE)
# Muuta df_SI:n pitkäksi muodoksi
df_SI_long_Mha <- df_SI %>%
dplyr::select(SI_class, all_of(Mha_columns)) %>%
# dplyr::select(-c(potential_grazingland_reduction_Mha,
#                  potential_grazingland_reduction_cl_mask_Mha,
#                  potential_grazingland_reduction_outside_cl_Mha   )) %>%
pivot_longer(cols = -SI_class, names_to = "Variable", values_to = "Value")
df_SI_long_protein <- df_SI %>%
dplyr::select(SI_class, all_of(prot_columns))  %>%
pivot_longer(cols = -SI_class, names_to = "Variable", values_to = "Value")
# HECTARES
plt_hectares_line <-
ggplot(df_SI_long_Mha %>% filter(SI_class>0), aes(x = SI_class, y = Value, color = Variable)) +
geom_line(size = 1) +
scale_x_continuous(breaks = seq(0, 100, 5), name = "SI Class") +
scale_y_continuous(name = "Million of ha") +
labs(title = "Comparison of production areas in different SI classes",
subtitle = "Agricultural land available for crop production at SI threshold") +
theme_classic() #+ theme(legend.position = "bottom")
plt_hectares_line
r_prot_allcrops_sum_kg_ha
r_potential_cropland_expansion_croplandmask_fraction[[99]]
r_potential_cropland_expansion_fraction[[99]]
r_SIbased_restricted_max_cropland_fraction_NAto0[[99]]
r_fraction_cl_NAto0
r_fraction_cl
r_fraction_gl
r_extra_protein_crops_test2_croplands_99 <-
f_raster_without_outliers(r_prot_allcrops_sum_kg_ha) * # 21 - 4235 kg per ha
cellSize(r_prot_allcrops_sum_kg_ha, unit = "ha")*
r_potential_cropland_expansion_croplandmask_fraction[[99]] # -1 to 1
global(r_extra_protein_crops_test2_croplands_99, "sum", na.rm=T)/1e9 # - mmt
r_extra_protein_crops_croplandmask_mt_perpix <-
f_raster_without_outliers(r_prot_allcrops_sum_kg_ha) * # 21 - 4235 kg per ha
cellSize(r_prot_allcrops_sum_kg_ha, unit = "ha")*
r_potential_cropland_expansion_croplandmask_fraction / # -1 to 1
1000
r_fraction_gl_cl_total
r_extra_protein_crops_croplandmask_mt_perpix
df_SI <- df_SI %>%
mutate(Extra_prot_croplands_mmt =
pull(global(r_extra_protein_crops_croplandmask_mt_perpix, "sum", na.rm=T)/1e6))
(681+975)/975
(212+274)/274
(975-450)/975
450/975
975-450
(274-112)/274
274-112
plot(r_potential_cropland_expansion_fraction[[33]])
r_new_protein_dairy_kg_perpix <-
r_protein_from_065xAGB_kg_ha$dairy *
cellSize(r_protein_from_065xAGB_kg_ha$dairy, unit = "ha") *
r_potential_cropland_expansion_fraction
df_SI <- df_SI %>%
mutate(Extra_prot_dairy_mmt =
pull(global(r_new_protein_dairy_kg_perpix, "sum", na.rm=T)/1e9))
r_potential_cropland_expansion_fraction
31.9 --11.9072339
r_predicted_protein_yield_outside_cl_but_in_gl_areas_kg_ha
c(1,10,85,99)
f_new_protein_yield_crops_mt_perpix <- function(layer_index) {
r_optimized_protein_yield_crops_mt_perpix_layer <-
ifel(test = r_fraction_cl_NAto0 == 0 & r_potential_cropland_expansion_fraction[[layer_index]] > 0, # if there is possibility to expand cl on gl areas (# pitääkö tämän ekan olla nimenomaan nolla vai ennemmin niin, jos ei ole suurempi kuin nolla?)
yes = ((r_predicted_protein_yield_outside_cl_but_in_gl_areas_kg_ha/ 1000) *
cellSize(r_predicted_protein_yield_outside_cl_but_in_gl_areas_kg_ha, unit = "ha")*
r_potential_cropland_expansion_outside_croplands_fraction[[layer_index]]), # multiply with approximated yield
no =   (f_raster_without_outliers(r_prot_allcrops_sum_kg_ha) * # 21 - 4235 kg per ha
cellSize(r_prot_allcrops_sum_kg_ha, unit = "ha")*
r_potential_cropland_expansion_croplandmask_fraction[[layer_index]] /
1000))
return(r_optimized_protein_yield_crops_mt_perpix_layer)
}
result_list_protein_yield_increase_basedOnSI <-
lapply(c(1,10,85,99),
f_new_protein_yield_crops_mt_perpix)
r_protein_yield_increase_basedOnSI_mt_perpix <- rast(result_list_protein_yield_increase_basedOnSI)
result_list_protein_yield_increase_basedOnSI <-
lapply(c(1,10,75,99),
f_new_protein_yield_crops_mt_perpix)
r_protein_yield_increase_basedOnSI_mt_perpix <- rast(result_list_protein_yield_increase_basedOnSI)
global(r_protein_yield_increase_basedOnSI_mt_perpix, "sum", na.rm = T)/1e6
r_protein_yield_increase_basedOnSI_mt_perpix_clmask <-
mask(r_protein_yield_increase_basedOnSI_mt_perpix,
r_physical_areas_crops_sum_ha_perpix)
global(r_protein_yield_increase_basedOnSI_mt_perpix_clmask, "sum", na.rm = T)/1e6
r_potential_cropland_expansion_outside_croplands_fraction[[10]]
# -------------------------------------------- koeta laskea outside cl eri tavalla
r_protein_increase_basedOnSI_crops_outside_cl_mt_perpix <-
((r_predicted_protein_yield_outside_cl_but_in_gl_areas_kg_ha/ 1000) *
cellSize(r_predicted_protein_yield_outside_cl_but_in_gl_areas_kg_ha, unit = "ha")*
r_potential_cropland_expansion_outside_croplands_fraction)
df_SI <- df_SI %>%
mutate(Protein_increase_basedOnSI_outside_cl_mmt =
pull(global(r_protein_increase_basedOnSI_crops_outside_cl_mt_perpix, "sum", na.rm=T)/1e6))
r_protein_yield_increase_basedOnSI_mt_perpix_outside_cl <-
mask(r_protein_yield_increase_basedOnSI_mt_perpix,
r_physical_areas_crops_sum_ha_perpix, inverse =T)
global(r_protein_yield_increase_basedOnSI_mt_perpix_outside_cl, "sum", na.rm = T)/1e6
global(r_protein_yield_increase_basedOnSI_mt_perpix_clmask, "sum", na.rm = T)/1e6
kok <- mask(r_fraction_cl_0toNA, r_fraction_gl_0toNA, inverse = T)
kok
plot(kok)
kok_area <- cellSize(kok, unit ="ha")*kok
global(kok_area)/1e6
global(kok_area, "sum", na.rm=T)/1e6
# testaa
plot(r_agb_hydeareas_kg_km2)
r_simulated_agb_vars <- #actually also from hard drive originally
here("Data", "Intermediate_input", "simulated_agb5v_agbIV_agbCV.tif") %>%
rast()
r_agb_hydeareas_kg_km2 <- r_simulated_agb_vars$agb_med_median
# testaa
kok2 <- mask(r_fraction_gl_0toNA, r_agb_hydeareas_kg_km2, inverse = T)
kok2
plot(kok2)
summary(kok2)
r_fraction_gl
r_prot_allcrops_sum_kg_ha
hist(r_prot_allcrops_sum_kg_ha)
hist((f_raster_without_outliers(r_prot_allcrops_sum_kg_ha))
)
r_potential_cropland_expansion_fraction
r_potential_cropland_expansion_fraction[[1]]
nlyr(r_potential_cropland_expansion_fraction)
threshold_values
r_protein_decrease_basedOnSI_dairy_kg_perpix
r_protein_decrease_basedOnSI_dairy_kg_perpix <-
r_protein_from_065xAGB_kg_ha$dairy *
cellSize(r_protein_from_065xAGB_kg_ha$dairy, unit = "ha") *
r_potential_cropland_expansion_fraction
names(r_protein_decrease_basedOnSI_dairy_kg_perpix) <-
paste0("dairyprot_kgpix_SI", threshold_values)
r_protein_decrease_basedOnSI_dairy_kg_perpix
r_protein_decrease_basedOnSI_dairy_kg_perpix
r_optimized_dairy_protein_kg_perpix <-
r_protein_decrease_basedOnSI_dairy_kg_perpix - r_protein_from_065xAGB_kg_perpix$dairy
r_optimized_dairy_protein_kg_perpix$dairyprot_kgpix_SI5 %>%
plot(., main = "When SI>5 vals 'd be used for crops, there'd be A LOT of cl and little gl")
r_optimized_dairy_protein_kg_perpix$dairyprot_kgpix_SI95 %>%
plot(., main = "When SI>95 vals 'd be used for crops, there'd be much less cl to convert and thus no gl dec")
r_protein_from_065xAGB_kg_perpix$dairy %>%
plot(., main = "Original dairy protein raster")
r_protein_decrease_basedOnSI_dairy_kg_perpix
r_optimized_dairy_protein_kg_perpix <-
r_protein_from_065xAGB_kg_perpix$dairy - r_protein_decrease_basedOnSI_dairy_kg_perpix
# check
r_optimized_dairy_protein_kg_perpix$dairyprot_kgpix_SI5 %>%
plot(., main = "When SI>5 vals 'd be used for crops, there'd be A LOT of cl and little gl")
r_protein_decrease_basedOnSI_dairy_kg_perpix
names(r_protein_decrease_basedOnSI_dairy_kg_perpix)
names(r_optimized_dairy_protein_kg_perpix)
names(r_optimized_dairy_protein_kg_perpix) <-
paste0("dairyprot_kgpix_SI", threshold_values)
# check
r_optimized_dairy_protein_kg_perpix$dairyprot_kgpix_SI5 %>%
plot(., main = "When SI>5 vals 'd be used for crops, there'd be A LOT of cl and little gl")
r_optimized_dairy_protein_kg_perpix$dairyprot_kgpix_SI95 %>%
plot(., main = "When SI>95 vals 'd be used for crops, there'd be much less cl to convert and thus no gl dec")
r_protein_from_065xAGB_kg_perpix$dairy %>%
plot(., main = "Original dairy protein raster")
df_SI <- df_SI %>%
mutate(Protein_decrease_basedOnSI_dairy_mmt =
pull(global(r_protein_decrease_basedOnSI_dairy_kg_perpix, "sum", na.rm=T)/1e9),
Optimised_dairy_protein_mmt =
pull(global(r_optimized_dairy_protein_kg_perpix, "sum", na.rm = T)/1e9))
172/274
525/975
102/274
( 274 - 102)/274
( 274 - 102)/102
f_new_protein_yield_crops_mt_perpix <- function(layer_index) {
r_protein_yield_increase_crops_mt_perpix_layer <-
ifel(test = r_fraction_cl_NAto0 == 0 & r_potential_cropland_expansion_fraction[[layer_index]] > 0, # if there is possibility to expand cl on gl areas (# pitääkö tämän ekan olla nimenomaan nolla vai ennemmin niin, jos ei ole suurempi kuin nolla?)
yes = ((r_predicted_protein_yield_outside_cl_but_in_gl_areas_kg_ha/ 1000) *
cellSize(r_predicted_protein_yield_outside_cl_but_in_gl_areas_kg_ha, unit = "ha")*
r_potential_cropland_expansion_outside_croplands_fraction[[layer_index]]), # multiply with approximated yield
no =   (f_raster_without_outliers(r_prot_allcrops_sum_kg_ha) * # 21 - 4235 kg per ha
cellSize(r_prot_allcrops_sum_kg_ha, unit = "ha")*
r_potential_cropland_expansion_croplandmask_fraction[[layer_index]] /
1000))
return(r_optimized_protein_yield_crops_mt_perpix_layer)
}
koo1 <-f_new_protein_yield_crops_mt_perpix[1]
koo1 <-f_new_protein_yield_crops_mt_perpix(1)
r_potential_cropland_expansion_croplandmask_fraction
koo1 <-  lapply(1:3,
f_new_protein_yield_crops_mt_perpix)
f_new_protein_yield_crops_mt_perpix <- function(layer_index) {
r_protein_yield_increase_crops_mt_perpix_layer <-
ifel(test = r_fraction_cl_NAto0 == 0 & r_potential_cropland_expansion_fraction[[layer_index]] > 0, # if there is possibility to expand cl on gl areas (# pitääkö tämän ekan olla nimenomaan nolla vai ennemmin niin, jos ei ole suurempi kuin nolla?)
yes = ((r_predicted_protein_yield_outside_cl_but_in_gl_areas_kg_ha/ 1000) *
cellSize(r_predicted_protein_yield_outside_cl_but_in_gl_areas_kg_ha, unit = "ha")*
r_potential_cropland_expansion_outside_croplands_fraction[[layer_index]]), # multiply with approximated yield
no = (f_raster_without_outliers(r_prot_allcrops_sum_kg_ha) * # 21 - 4235 kg per ha
cellSize(r_prot_allcrops_sum_kg_ha, unit = "ha")*
r_potential_cropland_expansion_croplandmask_fraction[[layer_index]] /
1000))
return(r_optimized_protein_yield_crops_mt_perpix_layer)
}
koo1 <-  lapply(1:2,
f_new_protein_yield_crops_mt_perpix)
1:""
1:2
c(1,2)
f_new_protein_yield_crops_mt_perpix <- function(layer_index) {
r_protein_yield_increase_crops_mt_perpix_layer <-
ifel(test = r_fraction_cl_NAto0 == 0 & r_potential_cropland_expansion_fraction[[layer_index]] > 0, # if there is possibility to expand cl on gl areas (# pitääkö tämän ekan olla nimenomaan nolla vai ennemmin niin, jos ei ole suurempi kuin nolla?)
yes = ((r_predicted_protein_yield_outside_cl_but_in_gl_areas_kg_ha/ 1000) *
cellSize(r_predicted_protein_yield_outside_cl_but_in_gl_areas_kg_ha, unit = "ha")*
r_potential_cropland_expansion_outside_croplands_fraction[[layer_index]]), # multiply with approximated yield
no =   (f_raster_without_outliers(r_prot_allcrops_sum_kg_ha) * # 21 - 4235 kg per ha
cellSize(r_prot_allcrops_sum_kg_ha, unit = "ha")*
r_potential_cropland_expansion_croplandmask_fraction[[layer_index]] /
1000))
return(r_optimized_protein_yield_crops_mt_perpix_layer)
}
koo1 <-  lapply(1:2,
f_new_protein_yield_crops_mt_perpix)
f_new_protein_yield_crops_mt_perpix <- function(layer_index) {
r_protein_yield_increase_crops_mt_perpix_layer <-
ifel(test = r_fraction_cl_NAto0 == 0 & r_potential_cropland_expansion_fraction[[layer_index]] > 0, # if there is possibility to expand cl on gl areas (# pitääkö tämän ekan olla nimenomaan nolla vai ennemmin niin, jos ei ole suurempi kuin nolla?)
yes = ((r_predicted_protein_yield_outside_cl_but_in_gl_areas_kg_ha/ 1000) *
cellSize(r_predicted_protein_yield_outside_cl_but_in_gl_areas_kg_ha, unit = "ha")*
r_potential_cropland_expansion_outside_croplands_fraction[[layer_index]]), # multiply with approximated yield
no = (f_raster_without_outliers(r_prot_allcrops_sum_kg_ha) * # 21 - 4235 kg per ha
cellSize(r_prot_allcrops_sum_kg_ha, unit = "ha")*
r_potential_cropland_expansion_croplandmask_fraction[[layer_index]] /
1000))
return(r_protein_yield_increase_crops_mt_perpix_layer)
}
koo1 <-  lapply(1:2,
f_new_protein_yield_crops_mt_perpix)
global(koo1, "sum", na.rm =T)/1e6
koo1 <- rast(koo1)
global(koo1, "sum", na.rm =T)/1e6
r_protein_inc_test_mt_perpix <-  lapply(c(1,2,3,75,99),
f_new_protein_yield_crops_mt_perpix)
r_protein_yield_increase_basedOnSI_mt_perpix_TEST <-
rast(r_protein_inc_test_mt_perpix)
# mask croplands and outside cl
r_protein_yield_increase_basedOnSI_mt_perpix_TEST_croplandmask <-
mask(r_protein_yield_increase_basedOnSI_mt_perpix_TEST,
r_physical_areas_crops_sum_ha_perpix)
r_protein_yield_increase_basedOnSI_mt_perpix_TEST_outside_cl <-
mask(r_protein_yield_increase_basedOnSI_mt_perpix_TEST,
r_physical_areas_crops_sum_ha_perpix, inverse = T)
global(r_protein_yield_increase_basedOnSI_mt_perpix_TEST, "sum", na.rm = T)/1e6
global(r_protein_yield_increase_basedOnSI_mt_perpix_TEST_croplandmask, "sum", na.rm = T)/1e6
global(r_protein_yield_increase_basedOnSI_mt_perpix_TEST_outside_cl, "sum", na.rm = T)/1e6
477.4786+312.26511233
410.3362+154.29288662
-104.0296+9.11583524
r_protein_increase_basedOnSI_crops_croplandmask_mt_perpix <-
f_raster_without_outliers(r_prot_allcrops_sum_kg_ha) * # 21 - 4235 kg per ha
cellSize(r_prot_allcrops_sum_kg_ha, unit = "ha")*
r_potential_cropland_expansion_croplandmask_fraction / # -1 to 1
1000
df_SI <- df_SI %>%
mutate(Protein_increase_basedOnSI_cl_mask_mmt =
pull(global(r_protein_increase_basedOnSI_crops_croplandmask_mt_perpix, "sum", na.rm=T)/1e6))
f_new_protein_yield_crops_mt_perpix2 <- function(layer_index) {
r_protein_yield_increase_crops_mt_perpix_layer <-
ifel(test = r_fraction_cl_NAto0 > 0,
yes = (f_raster_without_outliers(r_prot_allcrops_sum_kg_ha) * # 21 - 4235 kg per ha
cellSize(r_prot_allcrops_sum_kg_ha, unit = "ha")*
r_potential_cropland_expansion_croplandmask_fraction[[layer_index]] /
1000),
no = ((r_predicted_protein_yield_outside_cl_but_in_gl_areas_kg_ha/ 1000) *
cellSize(r_predicted_protein_yield_outside_cl_but_in_gl_areas_kg_ha, unit = "ha")*
r_potential_cropland_expansion_outside_croplands_fraction[[layer_index]]))
return(r_protein_yield_increase_crops_mt_perpix_layer)
}
r_protein_inc_test_mt_perpix2 <-  lapply(c(1,2,3,75,99),f_new_protein_yield_crops_mt_perpix2)
r_protein_yield_increase_basedOnSI_mt_perpix_TEST2 <-
rast(r_protein_inc_test_mt_perpix2)
# mask croplands and outside cl
r_protein_yield_increase_basedOnSI_mt_perpix_TEST_croplandmask2 <-
mask(r_protein_yield_increase_basedOnSI_mt_perpix_TEST2,
r_physical_areas_crops_sum_ha_perpix)
r_protein_yield_increase_basedOnSI_mt_perpix_TEST_outside_cl2 <-
mask(r_protein_yield_increase_basedOnSI_mt_perpix_TEST2,
r_physical_areas_crops_sum_ha_perpix, inverse = T)
global(r_protein_yield_increase_basedOnSI_mt_perpix_TEST2, "sum", na.rm = T)/1e6
global(r_protein_yield_increase_basedOnSI_mt_perpix_TEST_croplandmask2, "sum", na.rm = T)/1e6
global(r_protein_yield_increase_basedOnSI_mt_perpix_TEST_outside_cl2, "sum", na.rm = T)/1e6
plot(r_potential_cropland_expansion_croplandmask_fraction[[10]])
plot(r_potential_cropland_expansion_croplandmask_fraction[[75]])
plot(r_fraction_cl_0toNA)
# entä cl?
kok3 <- mask(r_fraction_cl_0toNA, r_physical_areas_crops_sum_ha_perpix, inverse= T)
plot(kok3)
r_protein_increase_basedOnSI_crops_croplandmask_mt_perpix
r_protein_increase_basedOnSI_crops_outside_cl_mt_perpix
tic()
r_protein_increase_basedOnSi_crops <-
classify(r_protein_increase_basedOnSI_crops_croplandmask_mt_perpix, cbind(NA,0)) +
classify(r_protein_increase_basedOnSI_crops_outside_cl_mt_perpix, cbind(NA,0))
toc()
r_protein_increase_basedOnSi_crops2 <-
app(c(r_protein_increase_basedOnSI_crops_croplandmask_mt_perpix,
r_protein_increase_basedOnSI_crops_outside_cl_mt_perpix),
fun = sum, na.rm = T)
toc()
tic()
r_protein_increase_basedOnSi_crops2 <-
app(c(r_protein_increase_basedOnSI_crops_croplandmask_mt_perpix,
r_protein_increase_basedOnSI_crops_outside_cl_mt_perpix),
fun = sum, na.rm = T)
toc()
62.76/520.1
r_protein_increase_basedOnSi_crops
r_protein_increase_basedOnSi_crops2
# tic() # app ei toimi koska palauttaa vain yhdn layerin
# r_protein_increase_basedOnSi_crops2 <-
#   app(c(r_protein_increase_basedOnSI_crops_croplandmask_mt_perpix,
#         r_protein_increase_basedOnSI_crops_outside_cl_mt_perpix),
#       fun = sum, na.rm = T)
# toc()
df_SI <- df_SI %>%
mutate(Protein_increase_basedOnSI_crops_mmt =
pull(global(r_protein_increase_basedOnSi_crops, "sum", na.rm=T)/1e6))
16.21083232+-22.610844
r_protein_increase_basedOnSI_crops <- r_protein_increase_basedOnSi_crops
r_prot_allcrops_sum_mt_perpix
r_protein_increase_basedOnSI_crops_mt_perpix <- r_protein_increase_basedOnSI_crops
r_optimised_protein_crops_mt_perpix <-
r_prot_allcrops_sum_mt_perpix +
r_protein_increase_basedOnSI_crops_mt_perpix
names(r_optimised_protein_crops_mt_perpix) <-
paste0("cropProt_mtpix_SI", threshold_values)
df_SI <- df_SI %>%
mutate(Optimised_crop_protein_mmt =
pull(global(r_optimised_protein_crops_mt_perpix, "sum", na.rm =T)/1e6))
815.01683-273
plot(r_protein_increase_basedOnSI_crops_mt_perpix[[10]])
r_optimised_protein_crops_mt_perpix <-
classify(r_prot_allcrops_sum_mt_perpix, cbind(NA, 0)) +
r_protein_increase_basedOnSI_crops_mt_perpix
names(r_optimised_protein_crops_mt_perpix) <-
paste0("cropProt_mtpix_SI", threshold_values)
df_SI <- df_SI %>%
mutate(Optimised_crop_protein_mmt =
pull(global(r_optimised_protein_crops_mt_perpix, "sum", na.rm =T)/1e6))
815.016832
+273
815.0168+273
plot(r_optimised_protein_crops_mt_perpix[[10]])
summary(r_optimised_protein_crops_mt_perpix[[10]])
summary(r_optimized_dairy_protein_kg_perpix[[10]])
r_optimised_protein_yield_whendairy_combined_with_crops_kg_perpix <-
classify(r_optimized_dairy_protein_kg_perpix, cbind(NA,0)) +
1000*r_optimised_protein_crops_mt_perpix
r_optimised_protein_yield_whendairy_combined_with_crops_kg_perpix <-
classify(r_optimized_dairy_protein_kg_perpix, cbind(NA,0)) +
1000*r_optimised_protein_crops_mt_perpix
_optimized_protein_yield_larger_percent <-
r_optimised_protein_yield_whendairy_combined_with_crops_kg_perpix
df_SI <- df_SI %>%
mutate(Optimised_combined_protein_mmt =
pull(global(r_optimised_protein_yield_whendairy_combined_with_crops_kg_perpix,
"sum", na.rm =T)/1e6))
Mha_columns <- grep("Mha", colnames(df_SI), value = TRUE)
# Muuta df_SI:n pitkäksi muodoksi
df_SI_long_Mha <- df_SI %>%
dplyr::select(SI_class, all_of(Mha_columns)) %>%
# dplyr::select(-c(potential_grazingland_reduction_Mha,
#                  potential_grazingland_reduction_cl_mask_Mha,
#                  potential_grazingland_reduction_outside_cl_Mha   )) %>%
pivot_longer(cols = -SI_class, names_to = "Variable", values_to = "Value")
# HECTARES
plt_hectares_line <-
ggplot(df_SI_long_Mha %>% filter(SI_class>0), aes(x = SI_class, y = Value, color = Variable)) +
geom_line(size = 1) +
scale_x_continuous(breaks = seq(0, 100, 5), name = "SI Class") +
scale_y_continuous(name = "Million of ha") +
labs(title = "Comparison of production areas in different SI classes",
subtitle = "Agricultural land available for crop production at SI threshold") +
theme_classic() #+ theme(legend.position = "bottom")
plt_hectares_line
prot_columns
colnames(df_SI)
prot_columns <- grep("protein", colnames(df_SI), value = TRUE)
prot_columns
df_SI_long_protein <- df_SI %>%
dplyr::select(SI_class, all_of(prot_columns))  %>%
pivot_longer(cols = -SI_class, names_to = "Variable", values_to = "Value")
plt_protein_line <-
ggplot(df_SI_long_protein %>% filter(SI_class>0), aes(x = SI_class, y = Value, color = Variable)) +
geom_line(size = 1) +
scale_x_continuous(breaks = seq(0, 100, 5), name = "SI Class") +
scale_y_continuous(name = "Protein, million tons") +
labs(title = "Comparison of protein production capacity in different SI classes",
subtitle = "Total protein production at SI threshold") +
theme_classic() # + theme(legend.position = "bottom") # Siirrä legenda kuvaajan alle
plt_protein_line
r_optimized_protein_yield_larger_percent <-
100*(r_optimised_protein_yield_whendairy_combined_with_crops_kg_perpix - r_protein_combined_kg_perpix$`when Dairy cattle`)/
r_protein_combined_kg_perpix$`when Dairy cattle`
r_optimized_protein_yield_larger_percent <-
100*(r_optimised_protein_yield_whendairy_combined_with_crops_kg_perpix - r_protein_combined_kg_perpix$`when Dairy cattle`)/
r_protein_combined_kg_perpix$`when Dairy cattle`
(plt_r_optimized_protein_yield_larger75 <-
create_index_map(r_index = r_optimized_protein_yield_larger_percent[[75]],
tocrs = "ESRI:54030",
index_main_title = "Optimised protein production compared to original combined protein production \n when SI >= 75(here dairy + crops considered)",
index_label = "%",
colorpal = pal_share_nuuk,
breakvals = c(-Inf, 1, 20, 50, 100, Inf),
breaknames = c("No change", "<20", "20-50", "50-100", ">100")))
(plt_r_optimized_protein_yield_larger33 <-
create_index_map(r_index = r_optimized_protein_yield_larger_percent[[33]],
tocrs = "ESRI:54030",
index_main_title = "Optimised protein production compared to original combined protein production \n when SI >= 33(here dairy + crops considered)",
index_label = "%",
colorpal = pal_share_nuuk,
breakvals = c(-Inf, 1, 20, 50, 100, Inf),
breaknames = c("No change", "<20", "20-50", "50-100", ">100")))
(plt_r_optimized_protein_yield_larger75 <-
create_index_map(r_index = r_optimized_protein_yield_larger_percent[[75]],
tocrs = "ESRI:54030",
index_main_title = "Optimised protein production compared to original combined protein production \n when SI >= 75(here dairy + crops considered)",
index_label = "%",
colorpal = pal_share_nuuk,
breakvals = c(-Inf, -50, 0, 20, 50, 100, Inf),
breaknames = c("-100 to -50", "-50 to -0",  "0 to 20", "20-50", "50-100", ">100")))
(plt_r_optimized_protein_yield_larger33 <-
create_index_map(r_index = r_optimized_protein_yield_larger_percent[[33]],
tocrs = "ESRI:54030",
index_main_title = "Optimised protein production compared to original combined protein production \n when SI >= 33(here dairy + crops considered)",
index_label = "%",
colorpal = pal_share_nuuk,
breakvals = c(-Inf, -50, 0, 20, 50, 100, Inf),
breaknames = c("-100 to -50", "-50 to -0",  "0 to 20", "20-50", "50-100", ">100")))
